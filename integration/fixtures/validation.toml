[[test]]
name = 'DuplicateCol'
query = '''
--! new_author(id?, id?)
INSERT INTO Author (id, name) VALUES (:id, :id);
'''
migration = '''
CREATE TABLE author (
  id SERIAL,
  name TEXT
);
'''
error = """
\u001B[38;2;255;30;30mcornucopia::validation::duplicate_nullable_col\u001B[0m

  \u001B[38;2;255;30;30m×\u001B[0m Could not validate queries
   ╭─[\u001B[38;2;92;157;255;1;4mqueries/module_1.sql\u001B[0m:1:1]
 \u001B[2m1\u001B[0m │ --! new_author(id?, id?)
   · \u001B[38;2;246;87;248m               ─┬\u001B[0m\u001B[38;2;30;201;212m   ─┬\u001B[0m
   ·                 \u001B[38;2;246;87;248m│\u001B[0m    \u001B[38;2;30;201;212m╰── \u001B[38;2;30;201;212mthis identifier is already in use\u001B[0m\u001B[0m
   ·                 \u001B[38;2;246;87;248m╰── \u001B[38;2;246;87;248mfirst used here\u001B[0m\u001B[0m
 \u001B[2m2\u001B[0m │ INSERT INTO Author (id, name) VALUES (:id, :id);
   ╰────"""

[[test]]
name = 'ColumnAlreadyNullable'
query = '''
--! new_author: (id?, name?, id?)
SELECT id, name FROM Author;
'''
migration = '''
CREATE TABLE author (
  id SERIAL,
  name TEXT
);
'''
error = """
\u001B[38;2;255;30;30mcornucopia::validation::duplicate_nullable_col\u001B[0m

  \u001B[38;2;255;30;30m×\u001B[0m Could not validate queries
   ╭─[\u001B[38;2;92;157;255;1;4mqueries/module_1.sql\u001B[0m:1:1]
 \u001B[2m1\u001B[0m │ --! new_author: (id?, name?, id?)
   · \u001B[38;2;246;87;248m                 ─┬\u001B[0m\u001B[38;2;30;201;212m          ─┬\u001B[0m
   ·                   \u001B[38;2;246;87;248m│\u001B[0m           \u001B[38;2;30;201;212m╰── \u001B[38;2;30;201;212mthis identifier is already in use\u001B[0m\u001B[0m
   ·                   \u001B[38;2;246;87;248m╰── \u001B[38;2;246;87;248mfirst used here\u001B[0m\u001B[0m
 \u001B[2m2\u001B[0m │ SELECT id, name FROM Author;
   ╰────"""

[[test]]
name = 'InvalidNullableColumnName'
query = '''
--! new_author: (name?)
SELECT id FROM Author;
'''
migration = '''
CREATE TABLE author (
  id SERIAL,
  name TEXT
);
'''
error = """
\u001B[38;2;255;30;30mcornucopia::validation::invalid_nullable_col\u001B[0m

  \u001B[38;2;255;30;30m×\u001B[0m Could not validate queries
   ╭─[\u001B[38;2;92;157;255;1;4mqueries/module_1.sql\u001B[0m:1:1]
 \u001B[2m1\u001B[0m │ --! new_author: (name?)
   · \u001B[38;2;246;87;248m                 ──┬─\u001B[0m
   ·                    \u001B[38;2;246;87;248m╰── \u001B[38;2;246;87;248mno column with this name found\u001B[0m\u001B[0m
 \u001B[2m2\u001B[0m │ SELECT id FROM Author;
   ╰────"""

[[test]]
name = 'QueryAlreadyExists'
query = '''
--! new_author
SELECT id FROM Author;

--! new_author
SELECT id FROM Author;
'''
migration = '''
CREATE TABLE author (
  id SERIAL,
  name TEXT
);
'''
error = """
\u001B[38;2;255;30;30mcornucopia::validation::duplicate_query_name\u001B[0m

  \u001B[38;2;255;30;30m×\u001B[0m Could not validate queries
   ╭─[\u001B[38;2;92;157;255;1;4mqueries/module_1.sql\u001B[0m:1:1]
 \u001B[2m1\u001B[0m │ --! new_author
   · \u001B[38;2;246;87;248m    ─────┬────\u001B[0m
   ·          \u001B[38;2;246;87;248m╰── \u001B[38;2;246;87;248mfirst defined here\u001B[0m\u001B[0m
 \u001B[2m2\u001B[0m │ SELECT id FROM Author;
 \u001B[2m3\u001B[0m │ 
 \u001B[2m4\u001B[0m │ --! new_author
   · \u001B[38;2;30;201;212m    ─────┬────\u001B[0m
   ·          \u001B[38;2;30;201;212m╰── \u001B[38;2;30;201;212mthis query name is already in use\u001B[0m\u001B[0m
 \u001B[2m5\u001B[0m │ SELECT id FROM Author;
   ╰────"""

[[test]]
name = 'NamedStructInvalidFields'
query = '''
--! author_names: Row
SELECT name FROM Author;

--! author_ids: Row
SELECT id FROM Author;
'''
migration = '''
CREATE TABLE author (
  id SERIAL,
  name TEXT
);
'''
error = """
\u001B[38;2;255;30;30mcornucopia::validation::incompatible_named_structs\u001B[0m

  \u001B[38;2;255;30;30m×\u001B[0m Could not validate queries
   ╭─[\u001B[38;2;92;157;255;1;4mqueries/module_1.sql\u001B[0m:1:1]
 \u001B[2m1\u001B[0m │ --! author_names: Row
   · \u001B[38;2;246;87;248m                  ─┬─\u001B[0m
   ·                    \u001B[38;2;246;87;248m╰── \u001B[38;2;246;87;248mcolumn `name` defined here\u001B[0m\u001B[0m
 \u001B[2m2\u001B[0m │ SELECT name FROM Author;
 \u001B[2m3\u001B[0m │ 
 \u001B[2m4\u001B[0m │ --! author_ids: Row
   · \u001B[38;2;30;201;212m                ─┬─\u001B[0m
   ·                  \u001B[38;2;30;201;212m╰── \u001B[38;2;30;201;212mcolumn `name` not found\u001B[0m\u001B[0m
 \u001B[2m5\u001B[0m │ SELECT id FROM Author;
   ╰────"""
