[[test]]
name = 'DuplicateCol'
query = '''
--! new_author(id?, id?)
INSERT INTO Author (id, name) VALUES (:id, :id);
'''
migration = '''
CREATE TABLE author (
  id SERIAL,
  name TEXT
);
'''
error = '''
Error while validating queries [path: "queries/module_1.sql"]:
 --> 1:21
  | 
  | --! new_author(id?, id?)
  |                     ^---
  | 
  = Column name is already used.'''

[[test]]
name = 'ColumnAlreadyNullable'
query = '''
--! new_author: (id?, name?, id?)
SELECT id, name FROM Author;
'''
migration = '''
CREATE TABLE author (
  id SERIAL,
  name TEXT
);
'''
error = '''
Error while validating queries [path: "queries/module_1.sql"]:
 --> 1:30
  | 
  | --! new_author: (id?, name?, id?)
  |                              ^---
  | 
  = Column name is already used.'''

[[test]]
name = 'InvalidNullableColumnName'
query = '''
--! new_author: (name?)
SELECT id FROM Author;
'''
migration = '''
CREATE TABLE author (
  id SERIAL,
  name TEXT
);
'''
error = '''
Error while validating queries [path: "queries/module_1.sql"]:
 --> 1:18
  | 
  | --! new_author: (name?)
  |                  ^---
  | 
  = No column named `name` found for this query.'''

[[test]]
name = 'QueryAlreadyExists'
query = '''
--! new_author
SELECT id FROM Author;

--! new_author
SELECT id FROM Author;
'''
migration = '''
CREATE TABLE author (
  id SERIAL,
  name TEXT
);
'''
error = '''
Error while validating queries [path: "queries/module_1.sql"]:
 --> 4:5
  | 
  | --! new_author
  |     ^---
  | 
  = This query's name is already used
 --> 1:5
  | 
  | --! new_author
  |     ^---
  | 
  = First defined here.'''

[[test]]
name = 'NamedStructInvalidFields'
query = '''
--! author_names: Row
SELECT name FROM Author;

--! author_ids: Row
SELECT id FROM Author;
'''
migration = '''
CREATE TABLE author (
  id SERIAL,
  name TEXT
);
'''
error = '''
Error while validating queries [path: "queries/module_1.sql"]:
 --> 1:19
  | 
  | --! author_names: Row
  |                   ^---
  | 
  = This named data structure has been defined elsewhere, but the fields don't match.
 --> 4:17
  | 
  | --! author_ids: Row
  |                 ^---
  | 
  = First defined here

Expected fields: [
  id: int4
]
Got fields: [
  name: text
]'''
